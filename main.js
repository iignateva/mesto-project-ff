!function(){"use strict";var e="https://nomoreparties.co/v1/".concat("wff-cohort-26"),t={authorization:"795c02ad-0380-472a-86a4-d4f6a3b46af0","Content-Type":"application/json"},n=function(n,r,o){return fetch("".concat(e,"/").concat(n),{method:r,headers:t,body:o}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},r="card__delete-button_is-hided";function o(e,t){e.textContent=t.likes.length>0?t.likes.length:""}function c(e,t,r){var c;c=e.classList.contains("card__like-button_is-active")?function(e){if(e)return n("/cards/likes/".concat(e),"DELETE")}(r):function(e){if(e)return n("/cards/likes/".concat(e),"PUT")}(r),c.then((function(e){o(t,e)})),e.classList.toggle("card__like-button_is-active")}function i(e,t,n,r){var o=e.querySelector(r);return o.src=t,o.alt=n,o}var a=function(e,t){i(e,t.src,t.alt,".popup__image"),e.querySelector(".popup__caption").textContent=t.alt,e.setAttribute("style","background-color: rgba(0, 0, 0, .9)")},u="popup_is-opened";function s(){var e=document.querySelector(".popup_is-opened");e&&d(e)}var l=function(e){"Escape"===e.key&&s()},p=function(e){e.target.classList.contains("popup")&&s()},d=function(e){e.classList.remove(u),document.removeEventListener("keyup",l),e.removeEventListener("click",p),f(e,!1)},_=function(){s()},f=function(e,t){var n=e.querySelector(".popup__close");n&&(t?n.addEventListener("click",_):n.removeEventListener("click",_))};function v(e,t,n){e.addEventListener("click",(function(r){!function(e){e.classList.add(u),document.addEventListener("keyup",l),e.addEventListener("click",p),f(e,!0)}(t),n&&n(t,e)}))}var y=function(e,t,n,r){e.classList.remove(t),n.textContent="",n.classList.remove(r)},m=function(e,t){e.disabled=!0,e.classList.add(t)},S=function(e,t){e.disabled=!1,e.classList.remove(t)},q=".popup__form",E=".popup__input",b="popup__input_type_error",L="popup__error_visible",k=".popup__button",h="popup__button_disabled",g=document.querySelector("#card-template").content,C=document.querySelector(".places .places__list"),x=document.querySelector(".popup_type_edit"),A=x.querySelector(q),T=A.querySelector(".popup__input_type_name"),P=A.querySelector(".popup__input_type_description"),M=document.querySelector(".profile__edit-button"),N=document.forms["edit-profile"],w=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),O=document.querySelector(".popup_type_new-card"),j=O.querySelector(q),I=j.querySelector(".popup__input_type_card-name"),J=j.querySelector(".popup__input_type_url"),V=document.querySelector(".popup_type_image"),B=document.querySelector(".profile__add-button"),G=document.querySelector(".profile__image"),H=document.querySelector(".popup_type_action-accept"),z=H.querySelector(k),U=document.querySelector(".popup_type_update-avatar"),F=U.querySelector(q),K=U.querySelector(".popup__input_type_url"),Q=function(e,t){C.append(function(e,t){return function(e,t,n,c,u,s,l){var p=e.querySelector(".card").cloneNode(!0);p.querySelector(".card__description .card__title").textContent=n.name;var d=p.querySelector(".card__likes-count");o(d,n);var _=p.querySelector(".card .card__delete-button");n.owner._id===c._id?(l(_,u,(function(){u.cardId=n._id,u.cardNode=p})),_.classList.remove(r)):_.classList.add(r);var f=p.querySelector(".card__like-button");return f.addEventListener("click",(function(){return s(f,d,n._id)})),l(i(p,n.link,n.name,".card__image"),t,a),p}(g,V,e,t,H,c,v)}(e,t))};z.addEventListener("click",(function(){var e=H.cardId,t=H.cardNode;e&&t&&(function(e){e&&n("/cards/".concat(e),"DELETE")}(e),t.remove()),d(H)}));var R=function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.buttonElementSelector);n.forEach((function(n){var r=e.querySelector(".".concat(n.id,"-error"));y(n,t.inputErrorClass,r,t.errorVisibleClass)})),m(r,t.inactiveButtonClass)}(e,{inputSelector:E,inputErrorClass:b,errorVisibleClass:L,buttonElementSelector:k,inactiveButtonClass:h})};A.addEventListener("submit",(function(e){e.preventDefault();var t={name:T.value,about:P.value};re(x,(function(){var e;(e=t,n("/users/me","PATCH",JSON.stringify(e))).then((function(e){W(e)}))})),A.reset(),d(x)})),F.addEventListener("submit",(function(e){e.preventDefault();var t={avatar:K.value};re(U,(function(){(function(e){if(e&&e.avatar)return n("/users/me/avatar","PATCH",JSON.stringify(e))})(t).then((function(e){W(e),F.reset(),d(U)}))}))}));var W=function(e){w.textContent=e.name,D.textContent=e.about,G.style.backgroundImage="url(".concat(e.avatar,")")};v(G,U),v(M,x,(function(){R(N),N&&(N.elements.name.value=w.textContent,N.elements.description.value=D.textContent)}));var X,Y,Z,$,ee,te,ne,re=function(e,t){var n=e.querySelector(k),r=n.textContent;n.textContent=r+"...",t(),n.textContent=r};j.addEventListener("submit",(function(e){e.preventDefault();var t={name:I.value,link:J.value};re(O,(function(){var e;(e=t,n("/cards","POST",JSON.stringify(e))).then((function(e){j.reset(),d(O),Q(e,e.owner)}))}))})),v(B,O,(function(){j.reset(),R(j)})),X=q,Y=E,Z=k,$=h,ee=b,te=L,Array.from(document.querySelectorAll(X)).forEach((function(e){var t=e.querySelector(Z),n=Array.from(e.querySelectorAll(Y));n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));if(t.validity.valid)y(t,n,o,r);else{var c=t.validationMessage;switch(!0){case t.validity.patternMismatch:c=t.dataset.errorPatternMismatchMessage;break;case t.validity.valueMissing:c=t.dataset.errorEmptyValueMessage}!function(e,t,n,r,o){e.classList.add(t),n.textContent=r,n.classList.add(o)}(t,n,o,c,r)}})(e,r,ee,te),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?S(t,n):m(t,n)}(n,t,$)}))}))})),ne=[n("/users/me","GET"),n("/cards","GET")],Promise.all(ne).then((function(e){var t=e[0],n=e[1];W(t),function(e,t){e.forEach((function(e){Q(e,t)}))}(n,t)}))}();